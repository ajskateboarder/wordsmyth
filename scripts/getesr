#!/usr/bin/python3
"""
Matches all the emojis the DeepMoji model uses to descriptions
from the Emoji Sentiment Ranking table
http://kt.ijs.si/data/Emoji_sentiment_ranking/index.html
"""

import json
import warnings

warnings.filterwarnings("ignore")

import requests
from bs4 import BeautifulSoup
from emoji import emojize, demojize

print("Grabbing emoji descriptions...")

EMOJIS = {
    "ğŸ˜‚": ":joy:",
    "ğŸ˜’": ":unamused:",
    "ğŸ˜©": ":weary:",
    "ğŸ˜­": ":sob:",
    "ğŸ˜": ":heart_eyes:",
    "ğŸ˜”": ":pensive:",
    "ğŸ‘Œ": ":ok_hand:",
    "ğŸ˜Š": ":blush:",
    "â™¥": ":heart:",
    "ğŸ˜": ":smirk:",
    "ğŸ˜": ":grin:",
    "ğŸ¶": ":notes:",
    "ğŸ˜³": ":flushed:",
    "ğŸ’¯": ":100:",
    "ğŸ˜´": ":sleeping:",
    "ğŸ˜Œ": ":relieved:",
    "â˜º": ":relaxed:",
    "ğŸ™Œ": ":raised_hands:",
    "ğŸ’•": ":two_hearts:",
    "ğŸ˜‘": ":expressionless:",
    "ğŸ˜…": ":sweat_smile:",
    "ğŸ™": ":pray:",
    "ğŸ˜•": ":confused:",
    "ğŸ˜˜": ":kissing_heart:",
    "ğŸ’“": ":heartbeat:",
    "ğŸ˜": ":neutral_face:",
    "ğŸ’": ":information_desk_person:",
    "ğŸ˜": ":disappointed:",
    "ğŸ™ˆ": ":see_no_evil:",
    "ğŸ˜«": ":tired_face:",
    "âœŒ": ":v:",
    "ğŸ˜": ":sunglasses:",
    "ğŸ˜¡": ":rage:",
    "ğŸ‘": ":thumbsup:",
    "ğŸ˜¢": ":cry:",
    "ğŸ˜ª": ":sleepy:",
    "ğŸ˜‹": ":yum:",
    "ğŸ˜¤": ":triumph:",
    "âœ‹": ":hand:",
    "ğŸ˜·": ":mask:",
    "ğŸ‘": ":clap:",
    "ğŸ‘€": ":eyes:",
    "ğŸ”«": ":gun:",
    "ğŸ˜£": ":persevere:",
    "ğŸ˜ˆ": ":smiling_imp:",
    "ğŸ˜“": ":sweat:",
    "ğŸ’”": ":broken_heart:",
    "ğŸ’›": ":yellow_heart:",
    "ğŸµ": ":musical_note:",
    "ğŸ™Š": ":speak_no_evil:",
    "ğŸ˜‰": ":wink:",
    "ğŸ’€": ":skull:",
    "ğŸ˜–": ":confounded:",
    "ğŸ˜„": ":smile:",
    "ğŸ˜œ": ":stuck_out_tongue_winking_eye:",
    "ğŸ˜ ": ":angry:",
    "ğŸ™…": ":no_good:",
    "ğŸ’ª": ":muscle:",
    "ğŸ‘Š": ":facepunch:",
    "ğŸ’œ": ":purple_heart:",
    "ğŸ’–": ":sparkling_heart:",
    "ğŸ’™": ":blue_heart:",
    "ğŸ˜¬": ":grimacing:",
    "âœ¨": ":sparkles:",
}


def get_emoji(text):
    try:
        return EMOJIS[text]
    except KeyError:
        return "unlisted"


req = requests.get("http://kt.ijs.si/data/Emoji_sentiment_ranking/index.html")
soup = BeautifulSoup(req.text, "html.parser")

trs = soup.find("table").find("tbody").find_all("tr")
groups = [
    {
        "emoji_repr": get_emoji(td[0].text),
        "emoji": td[0].text,
        "desc": td[-2].text.lower(),
        # negative, neutral, positive
        "ratio": [float(td[5].text), float(td[6].text), float(td[7].text)],
    }
    for tr in trs
    if (td := tr.find_all("td"))
]

print("Dumping matched emoji descriptions to esranks.json...")

json.dump(
    [g for g in groups if any(emoji in g["emoji"] for emoji in EMOJIS.keys())],
    open("esranks.json", "w"),
)

# for g in groups:
#     if any(emoji in g["emoji"] for emoji in EMOJIS):
#         print(g)
