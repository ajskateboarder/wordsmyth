version: '3.7'

services:
  # model servicers
  interns:
    network_mode: host
    container_name: ytstars_interns
    build:
      dockerfile: interns.dockerfile
      context: .
    ports:
      - 50051:50051
  # store video queues
  rabbitmq:
    network_mode: host
    image: rabbitmq:3-management
    container_name: ytstars_rmq_indexes
    ports:
      - 5672:5672
      - 15672:15672
  # host the web api
  web:
    network_mode: host
    container_name: ytstars_web
    command: bash -c "/app/wait.sh --timeout=0 localhost:5672; python3 /app/src/web/backend.py"
    depends_on:
      - rabbitmq
    build:
      dockerfile: web.dockerfile
      context: .
